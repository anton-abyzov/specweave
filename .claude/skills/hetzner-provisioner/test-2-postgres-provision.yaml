---
name: "Hetzner Provisioning with Managed Postgres"
description: "Provision CX11 instance + managed Postgres database for full-stack app"
skill: hetzner-provisioner
priority: P1
estimated_time: "10-15 minutes"

input:
  prompt: "Deploy my NextJS app on Hetzner with Postgres database"
  requirements:
    app_type: nextjs
    instance_type: cx11
    database: postgres
    database_size: "2GB"
    ssl: false
    budget: "$15/month"

expected_output:
  terraform_files_generated:
    - main.tf
    - variables.tf
    - outputs.tf
    - cloud-init.yaml
    - database.tf

  terraform_resources:
    - type: hcloud_server
      name: app
      server_type: cx11

    - type: hcloud_database
      name: postgres
      engine: postgresql
      version: "15"
      size: db-1x-small

    - type: hcloud_firewall
      name: app

  environment_variables:
    - DATABASE_URL: "postgresql://user:pass@[DB_HOST]:5432/dbname"
    - POSTGRES_HOST: "[DB_HOST from terraform output]"
    - POSTGRES_PORT: "5432"
    - POSTGRES_DB: "my_saas_db"

  dockerfile_generated: true

  docker_compose_generated: true
  docker_compose_services:
    - app
    - (database managed separately by Hetzner)

  cost_estimate:
    monthly: "$10.83"
    breakdown:
      - "CX11 instance: $5.83/month"
      - "Managed Postgres (2GB): $5.00/month"
      - "Storage (20GB): $0.50/month"
    total: "$11.33/month"
    within_budget: true

  deployment_guide:
    steps:
      - "Set HETZNER_API_TOKEN in GitHub secrets"
      - "Set database credentials in environment variables"
      - "Run terraform apply to provision infrastructure"
      - "Database will be accessible at terraform output"
      - "Configure app DATABASE_URL"
      - "Deploy app with GitHub Actions"

validation:
  - "terraform validate passes"
  - "hcloud_database resource exists in main.tf or database.tf"
  - "Database connection string in outputs.tf"
  - "Environment variables documented"
  - "Cost under $15/month"

expected_errors: []

success_criteria:
  - "Managed Postgres provisioned"
  - "Connection string outputted"
  - "Cost within budget"
  - "App can connect to database"
---
