---
name: "Token Budget Exceeded Handling"
description: "Tests context-loader behavior when requested files exceed token budget"
input:
  prompt: "Load context for large feature"
  files:
    - "features/002-large-feature/context-manifest.yaml"
  manifest_content:
    spec_sections:
      - "specifications/modules/payments/**/*.md"  # Large module
      - "specifications/modules/auth/**/*.md"      # Another large module
    max_context_tokens: 5000
    priority: high
  estimated_tokens:
    payments: 6000  # Exceeds budget alone
    auth: 4000
    total: 10000    # Far exceeds budget
expected_output:
  type: "error_with_suggestions"
  files_loaded: []
  tokens_used: 0
  within_budget: false
  error_message: "Token budget exceeded: estimated 10000 tokens, budget is 5000"
  suggestions:
    - "Increase max_context_tokens in manifest"
    - "Use more specific glob patterns"
    - "Load sections with anchors (e.g., #specific-section)"
    - "Split into multiple manifests"
  contains:
    - "Token budget exceeded"
    - "Estimated: 10000"
    - "Budget: 5000"
validation:
  - "Detects token budget violation BEFORE loading"
  - "Provides clear error message"
  - "Suggests actionable solutions"
  - "Does not partially load (all-or-nothing)"
  - "No crash or silent failure"
success_criteria:
  - "Pre-flight token estimation works"
  - "Budget enforcement works"
  - "Helpful error messages"
  - "Actionable recommendations"
---
