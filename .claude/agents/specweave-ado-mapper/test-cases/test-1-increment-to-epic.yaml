---
name: "Export Increment to ADO Epic"
description: "Tests if specweave-ado-mapper can export a SpecWeave increment to Azure DevOps as Epic + Features + User Stories + Tasks"
input:
  prompt: "Export increment 0001-user-authentication to Azure DevOps"
  files:
    - path: ".specweave/increments/0001-user-authentication/spec.md"
      content: |
        ---
        increment_id: "0001"
        title: "User Authentication"
        status: "planned"
        priority: "P1"
        ---

        # User Authentication

        ## User Stories

        ### US1-001: User can log in (Large - 8 acceptance criteria)

        **As a** registered user
        **I want to** log in with email and password
        **So that** I can access my account

        **Acceptance Criteria**:
        - [ ] TC-0001: Valid credentials redirect to dashboard
        - [ ] TC-0002: Invalid password shows error
        - [ ] TC-0003: Email not found shows error
        - [ ] TC-0004: Account locked after 5 failed attempts
        - [ ] TC-0005: Password reset link sent
        - [ ] TC-0006: Session expires after 24 hours
        - [ ] TC-0007: Multi-device login supported
        - [ ] TC-0008: Logout clears session

        ### US1-002: User can register (Small - 3 acceptance criteria)

        **As a** new user
        **I want to** register with email
        **So that** I can create an account

        **Acceptance Criteria**:
        - [ ] TC-0009: Registration form validates email
        - [ ] TC-0010: Password must be 8+ characters
        - [ ] TC-0011: Duplicate email shows error

    - path: ".specweave/increments/0001-user-authentication/tasks.md"
      content: |
        # Tasks: User Authentication

        ## User Story: US1-001
        - [ ] Create login API endpoint
        - [ ] Implement password validation
        - [ ] Create login UI

        ## User Story: US1-002
        - [ ] Create registration API endpoint
        - [ ] Implement email uniqueness check

  context:
    ado_organization: "mycompany"
    ado_project: "MyProject"
    area_path: "MyProject\\TeamA"
    iteration: "Sprint 24"

expected_output:
  type: "ado_work_items_created"

  epic:
    title: "[Increment 0001] User Authentication"
    work_item_type: "Epic"
    state: "New"
    priority: 1
    area_path: "MyProject\\TeamA"
    iteration: "Sprint 24"
    tags: ["specweave", "increment-0001"]
    custom_fields:
      SpecWeave.IncrementID: "0001-user-authentication"

  features:
    - title: "User can log in"  # Feature because >5 acceptance criteria
      work_item_type: "Feature"
      parent: "Epic ID"
      description_contains:
        - "**As a** registered user"
        - "TC-0001: Valid credentials redirect to dashboard"
        - "TC-0008: Logout clears session"
      acceptance_criteria:
        - "Valid credentials redirect to dashboard"
        - "Invalid password shows error"
        - "Account locked after 5 failed attempts"
      tags: ["specweave", "user-story"]
      custom_fields:
        SpecWeave.UserStoryID: "US1-001"
        SpecWeave.TestCaseIDs: "TC-0001, TC-0002, TC-0003, TC-0004, TC-0005, TC-0006, TC-0007, TC-0008"

  user_stories:
    - title: "User can register"  # User Story because ≤5 acceptance criteria
      work_item_type: "User Story"
      parent: "Epic ID"
      description_contains:
        - "**As a** new user"
        - "TC-0009: Registration form validates email"
      acceptance_criteria:
        - "Registration form validates email"
        - "Password must be 8+ characters"
        - "Duplicate email shows error"
      tags: ["specweave", "user-story"]
      custom_fields:
        SpecWeave.UserStoryID: "US1-002"
        SpecWeave.TestCaseIDs: "TC-0009, TC-0010, TC-0011"

  tasks:
    count: 5
    examples:
      - title: "Create login API endpoint"
        work_item_type: "Task"
        parent: "Feature (US1-001)"
        state: "New"

      - title: "Create registration API endpoint"
        work_item_type: "Task"
        parent: "User Story (US1-002)"
        state: "New"

  frontmatter_updated:
    file: ".specweave/increments/0001-user-authentication/spec.md"
    contains:
      - "ado:"
      - "epic_id:"
      - "epic_url:"
      - "features:"
      - "area_path: \"MyProject\\\\TeamA\""
      - "iteration: \"Sprint 24\""
      - "last_sync:"
      - "sync_direction: \"export\""

validation:
  - "Epic created with correct title format"
  - "Large user story (>5 criteria) → Feature"
  - "Small user story (≤5 criteria) → User Story"
  - "All tasks created with correct parent"
  - "Area Path set correctly"
  - "Iteration set correctly"
  - "Priority mapped (P1 → 1)"
  - "State mapped (planned → New)"
  - "Custom fields populated"
  - "Frontmatter updated with ADO metadata"

success_criteria:
  - "Epic exists in ADO"
  - "Feature and User Story created based on size"
  - "All Tasks linked correctly"
  - "Area Path and Iteration preserved"
  - "Bidirectional traceability maintained"

decision_logic:
  feature_vs_user_story:
    rule: "acceptance_criteria_count > 5 → Feature, else User Story"
    examples:
      - user_story: "US1-001"
        criteria_count: 8
        result: "Feature"
      - user_story: "US1-002"
        criteria_count: 3
        result: "User Story"
---
