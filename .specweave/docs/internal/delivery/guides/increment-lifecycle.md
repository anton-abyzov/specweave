# Increment Lifecycle Guide

**Complete guide to increment lifecycle management in SpecWeave**

This guide covers the complete lifecycle of SpecWeave increments, from creation to closure.

---

## Table of Contents

1. [Lifecycle Overview](#lifecycle-overview)
2. [Status Progression](#status-progression)
3. [WIP Limits](#wip-limits)
4. [Task vs Increment Decision](#task-vs-increment-decision)
5. [Adding Tasks to Current Increment](#adding-tasks-to-current-increment)
6. [Closing Increments with Leftover Transfer](#closing-increments-with-leftover-transfer)
7. [Increment Lifecycle Commands](#increment-lifecycle-commands)
8. [Frontmatter Schema](#frontmatter-schema)
9. [Example Workflows](#example-workflows)

---

## Lifecycle Overview

**CRITICAL**: SpecWeave enforces structured increment lifecycle with WIP limits to prevent context-switching overhead and ensure high-quality delivery.

### Increment Structure (Complete Anatomy)

```
.specweave/increments/0001-user-authentication/
│
├── spec.md                          # WHAT & WHY (< 250 lines)
│   ├── YAML frontmatter             # Metadata, status, priorities
│   ├── Overview                     # High-level feature description
│   ├── User Stories                 # US1-001, US1-002, etc.
│   ├── Acceptance Criteria          # TC-0001, TC-0002 (testable conditions)
│   └── References                   # Links to strategy docs
│
├── plan.md                          # HOW (< 500 lines)
│   ├── Technical Approach           # Architecture decisions
│   ├── Component Design             # Modules, services, APIs
│   ├── Data Model                   # Database schema, entities
│   ├── Integration Points           # External systems, APIs
│   └── References                   # Links to ADRs, architecture docs
│
├── tasks.md                         # Implementation Steps
│   ├── YAML frontmatter             # Total tasks, completion rate
│   ├── Task List                    # [ ] T001, [x] T002, [T] T003 (transferred)
│   ├── Priorities                   # P1 (critical), P2 (important), P3 (nice-to-have)
│   ├── Dependencies                 # Task → Task dependencies
│   └── Estimates                    # Time estimates per task
│
├── tests.md                         # Test Strategy
│   ├── Test Coverage Matrix         # TC-0001 → E2E test mapping
│   ├── Test Types                   # E2E, Unit, Integration
│   ├── Test Files                   # tests/e2e/auth.spec.ts
│   └── Success Criteria             # What "done" looks like
│
├── context-manifest.yaml            # Context Loading (70%+ token reduction)
│   ├── spec_sections                # Which strategy docs to load
│   ├── documentation                # Which architecture docs to load
│   ├── max_context_tokens           # Token budget (e.g., 10000)
│   └── priority                     # high | medium | low
│
├── logs/                            # Execution History
│   ├── execution.log                # Task execution timeline
│   ├── errors.log                   # Error tracking, debugging
│   ├── ai-session.log               # AI conversation logs
│   └── human-input.log              # User clarifications requested
│
├── scripts/                         # Automation & Helpers
│   ├── migration.sql                # Database migrations
│   ├── setup.sh                     # Environment setup
│   ├── validation.py                # Data validation scripts
│   └── cleanup.js                   # Teardown/cleanup scripts
│
└── reports/                         # Analysis & Documentation
    ├── completion.md                # Completion report (when closed)
    ├── test-results.md              # Test execution results
    ├── performance.md               # Performance analysis
    ├── security.md                  # Security review
    └── retrospective.md             # What went well, what to improve
```

### Key Files Explained

| File | Purpose | Max Size | Generated By |
|------|---------|----------|--------------|
| **spec.md** | WHAT & WHY (business requirements) | < 250 lines | PM Agent |
| **plan.md** | HOW (technical design) | < 500 lines | Architect Agent |
| **tasks.md** | Implementation checklist | Variable | Feature Planner |
| **tests.md** | Test strategy & mapping | Variable | QA Lead Agent |
| **context-manifest.yaml** | Context loading config | < 50 lines | Context Loader |

### Folder Purposes

| Folder | Purpose | When Created |
|--------|---------|--------------|
| **logs/** | Execution history, errors | First task execution |
| **scripts/** | Automation helpers | When scripts needed |
| **reports/** | Analysis documents | During/after implementation |

---

## Status Progression

### 5 Lifecycle Stages

```
backlog → planned → in-progress → completed → closed
   ↓         ↓          ↓             ↓          ↓
 Idea    Ready to   Work      All done    Archived
         start      ongoing   & tested    & reviewed
```

### Status Definitions

| Status | Definition | Location | Criteria |
|--------|------------|----------|----------|
| **backlog** | Idea identified, not yet planned | `.specweave/increments/_backlog/0001-name.md` | Basic idea documented |
| **planned** | Spec created, ready to start | `.specweave/increments/0001-name/` | spec.md + tasks.md created, dependencies identified |
| **in-progress** | Active development | Same location | ≥1 task started, WIP limit not exceeded |
| **completed** | All P1 tasks done, tests passing | Same location | All P1 tasks complete, tests pass, docs updated |
| **closed** | Reviewed, archived, WIP freed | Same location | Closure report generated, leftovers transferred |

### Lifecycle State Progression

```
Increment Created
    ↓
spec.md (YAML: status: planned)
    ↓
User starts work
    ↓
spec.md (YAML: status: in-progress)
    ↓
Tasks executed → logs/ created
    ↓
All P1 tasks done
    ↓
spec.md (YAML: status: completed)
    ↓
User closes increment
    ↓
reports/completion.md generated
    ↓
spec.md (YAML: status: closed)
```

---

## WIP Limits

### Purpose

**Prevent context-switching overhead** (20-40% productivity loss), ensure focus, improve quality.

### WIP Limit Guidelines

| Project Type | WIP Limit | Rationale |
|--------------|-----------|-----------|
| **Framework development** (SpecWeave repo) | 2-3 in progress | Allows core + 1-2 independent features |
| **User projects** (solo/small team 1-5) | 1-2 in progress | Better focus, higher quality |
| **User projects** (large team 10+) | 3-5 in progress | Multiple sub-teams, still limited |

### Enforcement

- ✅ `/create-increment` checks WIP limit before creating
- ✅ `/start-increment` checks WIP limit before starting
- ✅ Must close increment to free WIP slot

### Override

```bash
/create-increment "..." --force  # Override WIP limit (use sparingly)
```

**When to override** ✅:
- Truly independent work (no dependencies)
- Critical bug fix (production down)
- Blocked on external dependency

**When NOT to override** ❌:
- Impatient to start new work
- Avoiding difficult tasks
- Poor planning

---

## Task vs Increment Decision

### Decision Tree

```
New work request
      ↓
How long will this take?
      ↓
  Hours-Days  →  How many components?
                       ↓
                    1 component  →  TASK (add to current increment)
                    2+ components  →  INCREMENT (if WIP allows)
      ↓
  Weeks+  →  Check WIP limit
                ↓
            WIP < limit  →  NEW INCREMENT
            WIP at limit  →  Close existing or add to backlog
```

### Examples

| Request | Duration | Components | Decision |
|---------|----------|------------|----------|
| "Fix error in context-loader" | 2 hours | 1 skill | **TASK** - Add to current increment |
| "Add caching to context-loader" | 1 day | 1 skill | **TASK** - Add to current increment |
| "Add complete JIRA integration" | 2 weeks | 2 agents + 1 skill | **INCREMENT** - New folder (if WIP allows) |
| "Optimize performance" | 3 days | Multiple files | **TASK** or **INCREMENT** - Depends on scope |

### Rule of Thumb

- **< 1 day + 1 component** = TASK
- **Weeks + multiple components** = INCREMENT

---

## Adding Tasks to Current Increment

### When to Add ✅

- Bugs discovered during implementation
- Small enhancements (< 1 day)
- Error handling improvements
- Documentation updates
- Test additions
- Edge case handling

### How to Add

#### Option 1: Using Slash Command

```bash
/add-tasks 001 "Fix error handling in context-loader"
/add-tasks 001 --priority P2 "Add caching to skill-router"
```

#### Option 2: Manual Addition (tasks.md)

```markdown
## Additional Tasks (Added During Implementation)

### T051: Fix error handling in context-loader
**Added**: 2025-10-26
**Discovered**: During integration testing
**Priority**: P1
**Estimated**: 2 hours
**Status**: [ ] Pending

**Implementation**:
- Check if manifest file exists
- Return helpful error message
- Log warning to logs/errors.log
```

#### Option 3: Update Frontmatter (spec.md)

```yaml
---
updated: 2025-10-26  # ← Update this
total_tasks: 51      # ← Increment
---
```

---

## Closing Increments with Leftover Transfer

### When to Close ✅

- ✅ All P1 (critical) tasks completed
- ✅ All tests passing
- ✅ Documentation updated
- ❌ P2/P3 tasks MAY remain (can transfer)

### Valid Reasons to Transfer Leftovers

1. **Time-boxed completion** - 2 weeks up, 80% done is enough
2. **Lower priority work remains** - P2/P3 can wait
3. **Scope clarification** - Some tasks no longer relevant
4. **Blocked tasks** - Waiting on external dependencies
5. **Business pivot** - Priorities changed

### Closure Workflow

```bash
/close-increment 001

# System validates:
→ All P1 tasks completed? ✅
→ All tests passing? ✅
→ Documentation updated? ✅

# Identifies leftovers:
→ Leftovers: 6 tasks (3 P2, 3 P3)

# Presents options:
Transfer options:
A) Create new increment "0002-enhancements" with leftovers
B) Add to existing increment (select: 0002, 0003, 0004)
C) Cancel leftovers (document why)

Your choice? [A]

# Generates closure report:
→ Creating .specweave/increments/0001-core-framework/reports/closure-report.md
→ Completion: 88% (44/50 tasks)
→ Transferred to 0002-enhancements: 6 tasks
→ Status: closed
→ WIP slot freed (2/2 → 1/2)

✅ Increment 0001-core-framework closed successfully
```

### Closure Report Format

```markdown
# Increment Closure Report

**Increment**: 0001-core-framework
**Closed Date**: 2025-10-26
**Completion**: 88% (44/50 tasks)

## Transferred Tasks (to 0002-enhancements)

| Task | Description | Priority | Reason |
|------|-------------|----------|--------|
| T045 | Add caching to context-loader | P2 | Performance optimization |
| T046 | Add retry logic to skill-router | P2 | Error handling enhancement |
| T047 | Create skill usage analytics | P3 | Nice-to-have monitoring |

## Retrospective

**What went well**: Clear spec reduced scope creep
**What to improve**: Better task estimation
```

### Task Status Markers

- `[x]` - Completed
- `[ ]` - Not started
- `[-]` - In progress (optional)
- `[T]` - Transferred to another increment
- `[C]` - Canceled (no longer relevant)

### Transferred Task Tracking

**In target increment** (0002-enhancements/tasks.md):

```markdown
## Transferred Tasks (from 0001-core-framework)

### T001: Add caching to context-loader
**Transferred from**: 0001-core-framework (T045)
**Transfer date**: 2025-10-26
**Original priority**: P2
**Current priority**: P1 (promoted - now critical)
```

---

## Increment Lifecycle Commands

### Available Slash Commands

| Command | Purpose | Example |
|---------|---------|---------|
| `/create-increment` | Create new increment (checks WIP) | `/create-increment "JIRA Integration"` |
| `/start-increment` | Start planned increment (checks WIP) | `/start-increment 002` |
| `/add-tasks` | Add tasks to existing increment | `/add-tasks 001 "Fix bug in context-loader"` |
| `/close-increment` | Close with leftover transfer | `/close-increment 001` |
| `/list-increments` | View all increments and WIP status | `/list-increments --status in-progress` |

---

## Frontmatter Schema

### Complete spec.md Frontmatter

```yaml
---
increment: 0001-core-framework
title: "SpecWeave Core Framework"
priority: P1
status: in-progress  # backlog | planned | in-progress | completed | closed
created: 2025-01-25
updated: 2025-10-26
started: 2025-02-01      # When status → in-progress
completed: null           # When all P1 tasks done
closed: null              # When closure report generated
structure: user-stories

# Completion tracking
total_tasks: 50
completed_tasks: 44
completion_rate: 88

# Leftover tracking (when closed)
transferred_to: null      # e.g., "0002-enhancements"
transferred_tasks: 0
canceled_tasks: 0
transfer_reason: null

# Dependencies
dependencies:
  - none

# WIP tracking
wip_slot: 1               # Which WIP slot (1, 2, or 3)
---
```

---

## Example Workflows

### Example 1: Complete Project Lifecycle

```bash
# Week 1: Create and start core framework
/create-increment "Core Framework"     # Creates 001
/start-increment 001                   # Status: planned → in-progress
# WIP: 1/2

# Week 2-12: Add tasks as discovered
/add-tasks 001 "Fix error in context-loader"
/add-tasks 001 "Add retry logic"

# Week 12: 88% done, ready to move on
/close-increment 001

# System prompts:
→ Completion: 88% (44/50 tasks)
→ Leftovers: 6 P2/P3 tasks
→ Transfer to 0002-enhancements? [Yes]
→ Closure report generated
→ Status: closed
→ WIP freed: 1/2 → 0/2

# Week 13: Start new work
/create-increment "JIRA Integration"   # Creates 003
/start-increment 003
# WIP: 1/2

# Week 14: Can start another (independent work)
/create-increment "Figma Integration"  # Creates 004
/start-increment 004
# WIP: 2/2 (at limit)

# Week 15: Try to start third
/create-increment "GitHub Sync"        # Creates 005
/start-increment 005
# ⚠️ WIP limit reached (2/2)
# Options:
# A) Close 003 or 004 first
# B) Wait until one completes
# C) Override with --force (not recommended)
```

### Example 2: Real Increment with Frontmatter

```yaml
# spec.md frontmatter
---
increment: 0001-user-authentication
title: "User Authentication System"
priority: P1
status: in-progress
created: 2025-01-25
started: 2025-02-01
completed: null
closed: null

structure: user-stories
total_tasks: 25
completed_tasks: 18
completion_rate: 72

dependencies:
  - none

wip_slot: 1
---
```

### Example 3: Token Savings with Context Manifest

**Without manifest**: Load ALL strategy docs (50k tokens)
**With manifest**: Load ONLY auth docs (15k tokens)
**Savings: 70%** ✅

```yaml
# context-manifest.yaml
---
spec_sections:
  - .specweave/docs/internal/strategy/authentication/overview.md
  - .specweave/docs/internal/strategy/authentication/requirements.md

documentation:
  - .specweave/docs/internal/architecture/auth-system.md
  - .specweave/docs/internal/architecture/adr/0001-auth-method.md

max_context_tokens: 15000
priority: high
---
```

---

## Related Documentation

- [CLAUDE.md](../../../../CLAUDE.md) - Quick reference guide
- [Increment Validation](.specweave/docs/internal/delivery/guides/increment-validation.md) - Validation workflow
- [Testing Guide](.specweave/docs/internal/delivery/guides/testing-guide.md) - Test strategy
- [Git Workflow](.specweave/docs/internal/delivery/guides/git-workflow.md) - Branch strategy
- [Context Loading](.specweave/docs/internal/architecture/context-loading.md) - Context manifests

---

**This guide provides complete details on increment lifecycle management. For a quick overview, see CLAUDE.md.**
