# Supabase (Database + Auth + Storage + Edge Functions) Configuration
# Generated by SpecWeave Serverless Architecture Intelligence
#
# Note: Supabase doesn't have official Terraform provider yet.
# This uses Supabase CLI with null_resource provisioners.
# For production, use Supabase Management API or wait for official provider.

# Supabase Project (using CLI)
resource "null_resource" "supabase_project" {
  provisioner "local-exec" {
    command = <<-EOT
      supabase projects create {{projectName}} \
        --org-id {{orgId}} \
        --region {{region}} \
        --plan {{planType}} \
        --db-password '{{databasePassword}}'
    EOT
  }

  provisioner "local-exec" {
    when    = destroy
    command = "supabase projects delete {{projectName}} --org-id {{orgId}}"
  }
}

# Storage Buckets
{{#each storageBuckets}}
resource "null_resource" "storage_bucket_{{this}}" {
  provisioner "local-exec" {
    command = <<-EOT
      supabase storage create {{this}} \
        --project-ref {{projectName}} \
        --public
    EOT
  }

  depends_on = [null_resource.supabase_project]
}
{{/each}}

# Edge Functions
{{#if enableEdgeFunctions}}
resource "null_resource" "edge_functions" {
  provisioner "local-exec" {
    command = "supabase functions deploy --project-ref {{projectName}}"
  }

  depends_on = [null_resource.supabase_project]
}
{{/if}}
