{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://spec-weave.com/schemas/plugin-manifest.json",
  "title": "SpecWeave Plugin Manifest",
  "description": "Schema for SpecWeave plugin manifest.json files",
  "type": "object",
  "required": ["name", "version", "description", "specweave_core_version", "provides"],
  "properties": {
    "name": {
      "type": "string",
      "pattern": "^specweave-[a-z0-9-]+$",
      "minLength": 11,
      "maxLength": 64,
      "description": "Unique plugin name (must start with 'specweave-')",
      "examples": ["specweave-kubernetes", "specweave-github", "specweave-ml-ops"]
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+(-[a-z0-9.-]+)?(\\+[a-z0-9.-]+)?$",
      "description": "Semantic version (e.g., '1.0.0', '2.1.3-beta.1')",
      "examples": ["1.0.0", "2.1.3-beta.1", "0.4.0"]
    },
    "description": {
      "type": "string",
      "minLength": 10,
      "maxLength": 1024,
      "description": "Human-readable description of what this plugin does"
    },
    "author": {
      "type": "string",
      "maxLength": 256,
      "description": "Plugin author name or organization"
    },
    "license": {
      "type": "string",
      "enum": ["MIT", "Apache-2.0", "BSD-3-Clause", "ISC", "GPL-3.0", "LGPL-3.0", "MPL-2.0", "Unlicense"],
      "description": "SPDX license identifier"
    },
    "specweave_core_version": {
      "type": "string",
      "pattern": "^[><=~^]+\\d+\\.\\d+\\.\\d+$",
      "description": "Required SpecWeave core version (e.g., '>=0.4.0', '~0.4.0', '^0.4.0')",
      "examples": [">=0.4.0", "~0.4.0", "^0.4.0"]
    },
    "dependencies": {
      "type": "object",
      "properties": {
        "plugins": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^specweave-[a-z0-9-]+$"
          },
          "uniqueItems": true,
          "description": "Other plugins this plugin requires"
        }
      },
      "additionalProperties": false
    },
    "auto_detect": {
      "type": "object",
      "properties": {
        "files": {
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 1
          },
          "uniqueItems": true,
          "description": "File or directory patterns to detect (e.g., 'kubernetes/', '.git/')"
        },
        "packages": {
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 1
          },
          "uniqueItems": true,
          "description": "NPM package dependencies to detect (from package.json)"
        },
        "env_vars": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[A-Z][A-Z0-9_]*$"
          },
          "uniqueItems": true,
          "description": "Environment variables to detect"
        },
        "git_remote_pattern": {
          "type": "string",
          "minLength": 1,
          "description": "Regex pattern to match against git remote URL (e.g., 'github\\.com')"
        }
      },
      "additionalProperties": false
    },
    "provides": {
      "type": "object",
      "required": ["skills", "agents", "commands"],
      "properties": {
        "skills": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[a-z0-9-]+$",
            "minLength": 1
          },
          "uniqueItems": true,
          "description": "Skill names provided by this plugin"
        },
        "agents": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[a-z0-9-]+$",
            "minLength": 1
          },
          "uniqueItems": true,
          "description": "Agent names provided by this plugin"
        },
        "commands": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^specweave\\.[a-z0-9-.]+$",
            "minLength": 11
          },
          "uniqueItems": true,
          "description": "Command names provided by this plugin (must start with 'specweave.')"
        }
      },
      "additionalProperties": false
    },
    "triggers": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 2
      },
      "uniqueItems": true,
      "description": "Keywords that trigger plugin suggestions in specs/tasks"
    },
    "credits": {
      "type": "object",
      "properties": {
        "based_on": {
          "type": ["string", "null"],
          "format": "uri",
          "description": "Upstream source URL if forked from another project"
        },
        "original_author": {
          "type": "string",
          "maxLength": 256,
          "description": "Original author name if forked"
        },
        "contributors": {
          "type": "array",
          "items": {
            "type": "string",
            "maxLength": 256
          },
          "uniqueItems": true,
          "description": "List of contributors to this plugin"
        },
        "modifications": {
          "type": "array",
          "items": {
            "type": "string",
            "maxLength": 512
          },
          "description": "List of modifications made for SpecWeave integration"
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "name": "specweave-github",
      "version": "1.0.0",
      "description": "GitHub issues integration for SpecWeave increments",
      "author": "SpecWeave Team",
      "license": "MIT",
      "specweave_core_version": ">=0.4.0",
      "auto_detect": {
        "files": [".git/"],
        "env_vars": ["GITHUB_TOKEN"],
        "git_remote_pattern": "github\\.com"
      },
      "provides": {
        "skills": ["github-sync", "github-issue-tracker"],
        "agents": ["github-manager"],
        "commands": [
          "specweave.github.create-issue",
          "specweave.github.sync",
          "specweave.github.close-issue"
        ]
      },
      "triggers": ["github", "issue", "gh", "pull request", "PR"]
    },
    {
      "name": "specweave-kubernetes",
      "version": "1.0.0",
      "description": "Kubernetes deployment and management for SpecWeave projects",
      "author": "SpecWeave Team",
      "license": "MIT",
      "specweave_core_version": ">=0.4.0",
      "dependencies": {
        "plugins": ["specweave-cloud-infrastructure"]
      },
      "auto_detect": {
        "files": ["kubernetes/", "k8s/", "helm/"],
        "packages": ["@kubernetes/client-node"],
        "env_vars": ["KUBECONFIG"]
      },
      "provides": {
        "skills": ["k8s-deployer", "helm-manager", "k8s-troubleshooter"],
        "agents": ["devops"],
        "commands": ["specweave.k8s.deploy", "specweave.k8s.status"]
      },
      "triggers": ["kubernetes", "k8s", "kubectl", "helm", "pod", "deployment", "service"]
    },
    {
      "name": "specweave-observability",
      "version": "1.0.0",
      "description": "Observability & monitoring for SpecWeave projects (Prometheus, Grafana)",
      "author": "SpecWeave Team",
      "license": "MIT",
      "specweave_core_version": ">=0.4.0",
      "auto_detect": {
        "files": ["prometheus/", "grafana/"],
        "packages": ["prom-client", "@grafana/faro-web-sdk"]
      },
      "provides": {
        "skills": ["monitoring-setup", "metrics-collector", "alerting-config", "dashboard-generator"],
        "agents": ["sre"],
        "commands": ["specweave.observe.metrics", "specweave.observe.alerts"]
      },
      "triggers": ["monitoring", "prometheus", "grafana", "metrics", "observability", "alerting"],
      "credits": {
        "based_on": "https://github.com/wshobson/agents/tree/main/plugins/observability-monitoring",
        "original_author": "Seth Hobson",
        "modifications": [
          "Adapted for SpecWeave increment lifecycle",
          "Added /sync-docs integration",
          "SpecWeave naming conventions"
        ]
      }
    }
  ]
}
