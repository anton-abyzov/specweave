id: TC-003
name: SpecWeave Integration Test
description: Verify that the skill detects SpecWeave context and generates test reports in increment folders
priority: medium
category: integration

preconditions:
  - TC-001 and TC-002 pass
  - Running in a SpecWeave project (.specweave/ directory exists)
  - Active increment with in-progress status exists
  - Increment has reports/ directory

test_steps:
  - step: 1
    action: Execute test from within SpecWeave project
    expected: Executor detects SpecWeave context

  - step: 2
    action: Check console output for SpecWeave detection message
    expected: "ðŸ”· SpecWeave project detected" is logged

  - step: 3
    action: Verify active increment detection
    expected: "ðŸ“¦ Active increment: 0001-feature-name" is logged

  - step: 4
    action: Run test that generates results
    expected: Test executes and collects results

  - step: 5
    action: Generate test report using generateTestReport()
    expected: Markdown report is created

  - step: 6
    action: Save report using saveTestReport()
    expected: Report is saved to .specweave/increments/{id}/reports/

acceptance_criteria:
  - detectSpecWeaveContext() correctly identifies SpecWeave projects
  - Active increment is detected by checking tasks.md status
  - Test reports follow SpecWeave format (see SKILL.md)
  - Reports are saved to correct increment folder
  - Report includes all sections (summary, results, performance, accessibility)

test_data:
  project_root: /path/to/specweave-project
  increment_id: "0001-test-feature"
  increment_status: in-progress
  report_filename: e2e-test-report.md

expected_results:
  - isSpecweaveProject: true
  - activeIncrement: "0001-test-feature"
  - Report file exists at: .specweave/increments/0001-test-feature/reports/e2e-test-report.md
  - Report contains proper Markdown formatting
  - Report includes timestamp and test results

report_sections_required:
  - Test Summary (total, passed, failed, skipped)
  - Test Results (individual test details)
  - Performance Metrics (page load, interactions)
  - Accessibility Issues (grouped by type)
  - Recommendations (actionable items)

edge_cases:
  - No active increment: Should still work, just without increment context
  - Multiple in-progress increments: Use the first one found
  - reports/ directory missing: Create it automatically
  - Running outside SpecWeave: Should work normally without SpecWeave features

notes: |
  This test verifies the SpecWeave-specific enhancements that differentiate
  this skill from the original playwright-skill. The ability to automatically
  detect context and generate reports in the right place is a key feature.
